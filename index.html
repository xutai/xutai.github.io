<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
</head>

<body>
    <header>
        <h1>我的首页</h1>
        <button onclick="changeBGColor()">Change BG Color</button>
        <script>
            function hexadecimalConvertion() {
                // 10 to 16
                // Number.parseInt()
            }

            function colorConvertion(colorName) {
                // rgb to hexadecimal
                // 这里还是有问题，rgb(11,11,11) 和rgb(12, 123, 123)
                if (colorName.indexOf('rgb') !== -1) {
                    return colorName
                    const rgbArray = colorName.slice(4, -1).split(',')
                    let hex = '#'
                    for (let i = 0; i < rgbArray.length; i++) {
                        let hexString = Number.parseInt(rgbArray[i], 16)
                        if (i !== 2) {
                            hex += hexString + ', '
                        } else {
                            hex += hexString
                        }
                    }
                    console.log("hex:", hex)
                    return hex
                }
                // hexadecimal to rgb
                if (colorName.indexOf('#') !== -1) {
                    //  长度判断， 3位还是6位
                    //  0-F 转为 0 -16, switch 
                    // 在这里使用let colorName有报错
                    // Uncaught ReferenceError: Cannot access 'colorName' before initialization
                    // 是不是意思说先 let colorName 就是重新声明了，等于
                    // let colorName; colorName = colorName.xxx
                    // let colorName = colorName.slice(1)
                    colorName = colorName.slice(1)
                    if (colorName.length === 6) {
                        let rgb = 'rgb('
                        for (let i = 0; i < colorName.length / 2; i++) {
                            let snippet = colorName.slice(0, 2)
                            console.log("snippet:", snippet)
                            snippet = Number.parseInt(snippet, 16)
                            console.log("snippet:", snippet)
                            if (i !== 2) {
                                rgb += snippet + ', '
                            } else {
                                rgb += snippet
                            }
                        }
                        rgb += ')'
                        console.log("rgb:", rgb)
                        return rgb
                    } else if (colorName.length === 3) {
                        let rgb = 'rgb('
                        for (let i = 0; i < colorName.length; i++) {
                            let snippet = colorName.slice(0, 1)
                            snippet = Number.parseInt(snippet, 16)
                            // 这里有错误, f应该parse成255,而不是15
                            if (i !== 2) {
                                rgb += snippet + ', '
                            } else {
                                rgb += snippet
                            }
                        }
                        rgb += ')'
                        console.log("rgb:", rgb)
                        return rgb
                    }
                }

                return colorName

            }

            function changeBGColor() {
                let colorName = window.prompt('输入你想要的颜色', '')
                // window.localStorage.setItem('colorName', colorName)
                colorName = colorConvertion(colorName)
                document.body.style.backgroundColor = colorName
                console.log("document.body.style.backgroundColor:", document.body.style.backgroundColor)
                const loop = function (colorName) {
                    if (document.body.style.backgroundColor !== colorName) {
                        let colorName = window.prompt('请输入有效的颜色', '')
                        // 先对输入的值进行判断
                        colorName = colorConvertion(colorName)
                        document.body.style.backgroundColor = colorName
                        console.log("document.body.style.backgroundColor:", document.body.style.backgroundColor)
                        console.log("colorName:", colorName)
                        // 应该有个16转化为10进制的方法
                        loop(colorName)
                    } else {

                        window.localStorage.setItem('colorName', colorName)
                        document.body.style.backgroundColor = colorName
                    }
                }
                loop(colorName)

            }
            if (!window.localStorage.getItem('colorName')) {
                changeBGColor()
            } else {

                let colorName = window.localStorage.getItem('colorName')
                document.body.style.backgroundColor = colorName

            }
        </script>
        <p id="username"></p>
        <p id="logout" style="display: none;">退出登陆</p>
        <p><a href="/login" id="login">登录</a></p>
        <p><a href="/register" id="register">注册</a></p>
        <script>
            var username;
            /*
            const userContainer = document.getElementById('username')
            const loginContainer = document.getElementById('login')
            const registerContainer = document.getElementById('register')
            const logoutContainer = document.getElementById('logout')
            */
            const userContainer = getElementById('username')
            const loginContainer = getElementById('login')
            const registerContainer = getElementById('register')
            const logoutContainer = getElementById('logout')

            function getElementById(id) {
                return document.getElementById(id)
            }

            function checkLoginStatus() {
                console.log("username:", username)
                var username = document.cookie.replace(/(?:(?:^|.*;\s*)a\s*\=\s*([^;]*).*$)|^.*$/, "$1");
                console.log('1')
                if (username) {
                    console.log('2')
                    userContainer.innerText = username
                    logoutContainer.style.display = "block"
                    loginContainer.style.display = 'none'
                    registerContainer.style.display = 'none'
                } else {
                    console.log('3')
                    userContainer.innerText = ''
                    logoutContainer.style.display = "none"
                    loginContainer.style.display = 'block'
                    registerContainer.style.display = 'block'
                }
            }


            checkLoginStatus()

            logoutContainer.addEventListener('click', () => {
                document.cookie = 'a=whatever; max-age=-1 '
                console.log(document.cookie)
                checkLoginStatus()
            })
        </script>
    </header>
    <main></main>
    <footer></footer>
</body>

</html>
